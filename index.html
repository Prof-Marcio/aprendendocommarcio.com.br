<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA MESTRE 360 | GESTÃO SUPREMA PROF. MÁRCIO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0f172a; --accent: #38bdf8; --secondary: #1e293b; --bg: #f8fafc; --white: #ffffff; --danger: #ef4444; --warning: #f59e0b; --success: #10b981; --purple: #8b5cf6; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        body { background: var(--bg); display: flex; height: 100vh; overflow: hidden; color: #334155; }
        
        /* SIDEBAR PREMIUM */
        aside { width: 280px; background: var(--primary); color: white; display: flex; flex-direction: column; box-shadow: 4px 0 20px rgba(0,0,0,0.2); z-index: 100; }
        .aside-header { padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); background: linear-gradient(to bottom, rgba(56,189,248,0.1), transparent); }
        .aside-header h2 { font-size: 20px; font-weight: 800; letter-spacing: 1px; color: var(--accent); }
        .nav-group { padding: 20px 15px 5px; font-size: 10px; color: #64748b; text-transform: uppercase; font-weight: 700; }
        .nav-item { width: 100%; padding: 12px 20px; background: none; border: none; color: #94a3b8; display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 500; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: var(--secondary); color: var(--accent); }
        .nav-item.active { border-right: 4px solid var(--accent); background: rgba(56,189,248,0.05); }

        main { flex: 1; padding: 30px; overflow-y: auto; scroll-behavior: smooth; }
        .section { display: none; animation: slideUp 0.4s ease-out; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* WIDGETS E CARDS */
        .grid-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border-left: 5px solid var(--accent); }
        .header-box { background: var(--white); padding: 20px; border-radius: 16px; margin-bottom: 25px; display: flex; align-items: center; gap: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        
        /* TABELAS E BOTÕES */
        .table-container { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e2e8f0; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #f1f5f9; padding: 15px; font-size: 12px; text-transform: uppercase; color: #475569; }
        td { padding: 15px; border-top: 1px solid #f1f5f9; font-size: 14px; }
        .col-fixa { position: sticky; left: 0; background: white; font-weight: 700; border-right: 2px solid #f1f5f9; z-index: 10; }
        
        .btn-status { padding: 6px 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; transition: 0.2s; }
        .st-P { background: #dcfce7; color: #166534; }
        .st-F { background: #fee2e2; color: #991b1b; }
        .btn-acao { padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; background: var(--accent); color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        /* APRESENTAÇÃO DE AULA (MODO PROJETOR) */
        .projetor-container { background: var(--primary); color: white; padding: 40px; border-radius: 20px; min-height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border: 4px solid var(--accent); }
        .projetor-slide { font-size: 32px; font-weight: 300; line-height: 1.5; }

        /* MAPA DE FOTOS */
        .mapa-sala { display: grid; grid-template-columns: repeat(7, 1fr); gap: 15px; background: #e2e8f0; padding: 20px; border-radius: 20px; }
        .carteira { background: white; border-radius: 12px; padding: 5px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.3s; }
        .carteira:hover { border-color: var(--accent); transform: scale(1.05); }
        .carteira img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; margin-bottom: 5px; }
        .carteira span { font-size: 10px; font-weight: 800; color: var(--primary); }

        /* CRONÔMETRO */
        .timer-box { position: fixed; bottom: 20px; right: 20px; background: var(--white); padding: 15px; border-radius: 50px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 15px; border: 2px solid var(--accent); z-index: 999; }
    </style>
</head>
<body>

<aside>
    <div class="aside-header">
        <h2>MESTRE 360 v.SUPREMA</h2>
        <p style="font-size: 10px; opacity: 0.7;">BEM-VINDO PROF. MÁRCIO</p>
    </div>
    
    <div class="nav-group">ESTRUTURA BASE</div>
    <button class="nav-item active" onclick="nav('config')"><i class="fas fa-layer-group"></i> 1. GESTÃO TURMAS</button>
    <button class="nav-item" onclick="nav('cadastro')"><i class="fas fa-user-plus"></i> 2. CADASTRO ALUNOS</button>
    <button class="nav-item" onclick="nav('mapa')"><i class="fas fa-th-large"></i> 3. MAPA DE FOTOS</button>
    
    <div class="nav-group">DIÁRIO DE BORDO</div>
    <button class="nav-item" onclick="nav('freq')"><i class="fas fa-check-double"></i> 4. FREQUÊNCIA/BIMESTRE</button>
    <button class="nav-item" onclick="nav('conteudo')"><i class="fas fa-pen-nib"></i> 5. REGISTRO CONTEÚDOS</button>
    <button class="nav-item" onclick="nav('notas')"><i class="fas fa-graduation-cap"></i> 6. NOTAS E MÉDIAS</button>
    
    <div class="nav-group">PEDAGÓGICO & SHOW</div>
    <button class="nav-item" onclick="nav('projetos')"><i class="fas fa-lightbulb"></i> 7. PLANO DE AULA</button>
    <button class="nav-item" onclick="nav('apresentacao')"><i class="fas fa-desktop"></i> 8. APRESENTAÇÃO (TV)</button>
    
    <div class="nav-group">ADMINISTRATIVO</div>
    <button class="nav-item" onclick="nav('arquivos')"><i class="fas fa-cloud-upload-alt"></i> 9. ARQUIVOS/DOCS</button>
    <button class="nav-item" onclick="nav('stats')"><i class="fas fa-chart-bar"></i> 10. ESTATÍSTICAS</button>
</aside>

<main>
    <section id="config" class="section active">
        <div class="header-box"><h1>Minhas Turmas</h1></div>
        <div class="card">
            <div style="display:flex; gap:15px;">
                <input type="text" id="nome-turma" style="flex:1" placeholder="Ex: 3º ANO B - ENSINO MÉDIO">
                <button class="btn-acao" onclick="addTurma()">CRIAR NOVA TURMA</button>
            </div>
            <div class="table-container" style="margin-top:20px;">
                <table>
                    <thead><tr><th>Identificação da Turma</th><th>Qtd. Alunos</th><th>Ações</th></tr></thead>
                    <tbody id="corpo-turmas"></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="cadastro" class="section">
        <div class="header-box">
            <span>Turma Selecionada:</span>
            <select id="sel-t-cadastro" onchange="renderAlunos()"></select>
        </div>
        <div class="table-container">
            <table>
                <thead><tr><th width="80">Chamada</th><th>Nome Completo do Estudante</th><th>Status</th></tr></thead>
                <tbody id="corpo-alunos"></tbody>
            </table>
        </div>
    </section>

    <section id="mapa" class="section">
        <div class="header-box">
            <select id="sel-t-mapa" onchange="renderMapa()"></select>
            <p>Toque na carteira para adicionar a foto do aluno.</p>
        </div>
        <input type="file" id="input-foto" style="display:none" accept="image/*" onchange="processarFoto(event)">
        <div class="mapa-sala" id="grid-mapa"></div>
    </section>

    <section id="freq" class="section">
        <div class="header-box">
            <select id="sel-t-freq" onchange="renderFreq()"></select>
            <div style="display:flex; gap:5px; background:#e2e8f0; padding:5px; border-radius:10px;">
                <button class="tab active" onclick="setBim(1)">1ºB</button>
                <button class="tab" onclick="setBim(2)">2ºB</button>
                <button class="tab" onclick="setBim(3)">3ºB</button>
                <button class="tab" onclick="setBim(4)">4ºB</button>
            </div>
            <input type="date" id="data-aula">
            <button class="btn-acao" onclick="novaData()"><i class="fas fa-calendar-plus"></i></button>
        </div>
        <div class="table-container">
            <table id="tabela-freq">
                <thead id="head-freq"></thead>
                <tbody id="corpo-freq"></tbody>
            </table>
        </div>
    </section>

    <section id="notas" class="section">
        <div class="header-box"><h1>Notas e Avaliações</h1><select id="sel-t-notas" onchange="renderNotas()"></select></div>
        <div class="table-container">
            <table>
                <thead><tr><th class="col-fixa">ALUNO</th><th>AVAL. 1</th><th>AVAL. 2</th><th>TRABALHO</th><th>MÉDIA</th></tr></thead>
                <tbody id="corpo-notas"></tbody>
            </table>
        </div>
    </section>

    <section id="apresentacao" class="section">
        <div class="header-box"><h1>Modo Projetor: Aula de Hoje</h1><select id="sel-t-apr" onchange="renderApresentacao()"></select></div>
        <div class="projetor-container" id="painel-projetor">
            <div class="projetor-slide">Selecione uma turma para carregar o Plano de Aula e apresentar aos alunos.</div>
        </div>
    </section>

    <section id="stats" class="section">
        <div class="grid-dashboard">
            <div class="stat-card"><h4>Frequência Geral</h4><p id="stat-freq">0%</p></div>
            <div class="stat-card"><h4>Média da Turma</h4><p id="stat-media">0.0</p></div>
        </div>
        <div class="card"><canvas id="graficoTurma" height="100"></canvas></div>
    </section>
</main>

<div class="timer-box">
    <i class="fas fa-stopwatch fa-2x" style="color:var(--accent)"></i>
    <span id="display-timer" style="font-size:20px; font-weight:800; font-family:monospace;">00:00</span>
    <button onclick="startTimer()" class="btn-status st-P">START</button>
</div>

<script>
    // BANCO DE DADOS SUPREMO
    let db = JSON.parse(localStorage.getItem('M360_SUPREMO_V1')) || { turmas: {}, arquivos: [] };
    let bimAtual = 1;
    let cartAlvo = null;

    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const target = document.getElementById(id);
        if(target) target.classList.add('active');
        event.currentTarget.classList.add('active');
        povoarSelects();
        
        if(id === 'config') renderTurmas();
        if(id === 'cadastro') renderAlunos();
        if(id === 'mapa') renderMapa();
        if(id === 'freq') renderFreq();
        if(id === 'notas') renderNotas();
        if(id === 'apresentacao') renderApresentacao();
    }

    // --- TURMAS ---
    function addTurma() {
        let n = document.getElementById('nome-turma').value.toUpperCase().trim();
        if(!n) return;
        db.turmas[n] = { 
            alunos: {}, fotos: {}, 
            chamadas: { 1: {}, 2: {}, 3: {}, 4: {} },
            notas: {}, conteudos: {}, plano: "Bem-vindos à aula de hoje! \n Objetivo: Introdução ao tema..."
        };
        salvar(); renderTurmas();
    }

    function renderTurmas() {
        const corpo = document.getElementById('corpo-turmas');
        corpo.innerHTML = Object.keys(db.turmas).map(t => {
            let total = Object.keys(db.turmas[t].alunos).filter(k => db.turmas[t].alunos[k]).length;
            return `<tr><td><b>${t}</b></td><td>${total} Alunos</td>
            <td><button class="btn-status st-F" onclick="delTurma('${t}')">Remover</button></td></tr>`;
        }).join('');
    }

    function delTurma(t) { if(confirm("Apagar turma permanentemente?")) { delete db.turmas[t]; salvar(); renderTurmas(); } }

    // --- ALUNOS ---
    function renderAlunos() {
        const t = document.getElementById('sel-t-cadastro').value;
        const corpo = document.getElementById('corpo-alunos');
        corpo.innerHTML = ''; if(!t) return;
        for(let i=1; i<=49; i++) {
            let n = db.turmas[t].alunos[i] || '';
            corpo.innerHTML += `<tr><td>${i}</td>
            <td><input type="text" style="width:100%; border:none;" value="${n}" onchange="salvarAluno('${t}',${i},this.value)"></td>
            <td><i class="fas fa-circle" style="color:${n?'var(--success)':'#eee'}"></i></td></tr>`;
        }
    }
    function salvarAluno(t, i, v) { db.turmas[t].alunos[i] = v.toUpperCase(); salvar(); }

    // --- FREQUÊNCIA ---
    function setBim(b) {
        bimAtual = b;
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i+1 === b));
        renderFreq();
    }

    function renderFreq() {
        const t = document.getElementById('sel-t-freq').value;
        if(!t) return;
        const head = document.getElementById('head-freq');
        const corpo = document.getElementById('corpo-freq');
        const chamadas = db.turmas[t].chamadas[bimAtual];
        const datas = Object.keys(chamadas).sort();

        head.innerHTML = `<tr><th class="col-fixa">Estudante</th>${datas.map(d => `<th>${d.split('-').reverse().slice(0,2).join('/')}</th>`).join('')}</tr>`;
        
        corpo.innerHTML = '';
        Object.keys(db.turmas[t].alunos).forEach(num => {
            if(db.turmas[t].alunos[num]) {
                let r = `<tr><td class="col-fixa">${num}. ${db.turmas[t].alunos[num]}</td>`;
                datas.forEach(d => {
                    let s = chamadas[d][num] || 'P';
                    r += `<td><button class="btn-status st-${s}" onclick="toggleFreq(this, '${t}', '${d}', '${num}')">${s}</button></td>`;
                });
                corpo.innerHTML += r + `</tr>`;
            }
        });
    }

    function toggleFreq(btn, t, d, num) {
        let n = btn.innerText === 'P' ? 'F' : 'P';
        btn.innerText = n; btn.className = `btn-status st-${n}`;
        db.turmas[t].chamadas[bimAtual][d][num] = n; salvar();
    }

    function novaData() {
        const t = document.getElementById('sel-t-freq').value;
        const d = document.getElementById('data-aula').value;
        if(!t || !d) return alert("Defina a data!");
        if(!db.turmas[t].chamadas[bimAtual][d]) {
            db.turmas[t].chamadas[bimAtual][d] = {};
            Object.keys(db.turmas[t].alunos).forEach(n => { if(db.turmas[t].alunos[n]) db.turmas[t].chamadas[bimAtual][d][n] = 'P'; });
            salvar(); renderFreq();
        }
    }

    // --- MAPA ---
    function renderMapa() {
        const t = document.getElementById('sel-t-mapa').value;
        const grid = document.getElementById('grid-mapa');
        grid.innerHTML = ''; if(!t) return;
        for(let i=1; i<=49; i++) {
            const f = db.turmas[t].fotos[i] || 'https://via.placeholder.com/100?text=FOTO';
            const n = db.turmas[t].alunos[i] || 'VAGO';
            grid.innerHTML += `<div class="carteira" onclick="cartAlvo=${i}; document.getElementById('input-foto').click()">
                <img src="${f}"><span>${i}. ${n.split(' ')[0]}</span></div>`;
        }
    }

    function processarFoto(e) {
        const t = document.getElementById('sel-t-mapa').value;
        const r = new FileReader();
        r.onload = (ev) => { db.turmas[t].fotos[cartAlvo] = ev.target.result; salvar(); renderMapa(); };
        r.readAsDataURL(e.target.files[0]);
    }

    // --- APRESENTAÇÃO ---
    function renderApresentacao() {
        const t = document.getElementById('sel-t-apr').value;
        const painel = document.getElementById('painel-projetor');
        if(!t) return;
        painel.innerHTML = `<div class="projetor-slide"><h1>${t}</h1><hr style="margin:20px; border-color:var(--accent)"><p>${db.turmas[t].plano || 'Sem plano cadastrado'}</p></div>`;
    }

    // --- AUXILIARES ---
    function salvar() { localStorage.setItem('M360_SUPREMO_V1', JSON.stringify(db)); }
    
    function povoarSelects() {
        const ids = ['sel-t-cadastro', 'sel-t-mapa', 'sel-t-freq', 'sel-t-notas', 'sel-t-apr'];
        const opt = Object.keys(db.turmas).map(t => `<option value="${t}">${t}</option>`).join('');
        ids.forEach(id => {
            const s = document.getElementById(id);
            if(s) { 
                const valAntigo = s.value;
                s.innerHTML = opt; 
                if(valAntigo && opt.includes(valAntigo)) s.value = valAntigo;
            }
        });
    }

    // TIMER
    let tSeg = 0;
    function startTimer() {
        setInterval(() => {
            tSeg++;
            let m = Math.floor(tSeg / 60);
            let s = tSeg % 60;
            document.getElementById('display-timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);
    }

    window.onload = () => { povoarSelects(); renderTurmas(); };
</script>
</body>
</html>