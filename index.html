<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SALA M√ÅRCIO V30 - SISTEMA COMPLETO</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --bg-body: #0f172a;
            --folha-cor: #ffffff;
            --parede: #1e293b;
            --carteira: #f59e0b;
            --zoom: 0.9;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { background: var(--bg-body); height: 100vh; display: flex; flex-direction: column; overflow: hidden; color: white; }

        /* HEADER PROFISSIONAL */
        header { 
            background: #1e293b; padding: 10px 15px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 1px solid #334155; 
        }
        header h1 { font-size: 14px; color: #3b82f6; }

        /* √ÅREA DA FOLHA */
        .viewport { 
            flex-grow: 1; overflow: auto; display: flex; justify-content: center; 
            align-items: flex-start; padding: 40px 20px; background: #334155; 
            perspective: 1000px;
        }

        .a4-page {
            width: 210mm; min-height: 297mm; background: var(--folha-cor); color: #000;
            padding: 15mm; position: relative; flex-shrink: 0;
            transform: scale(var(--zoom)); transform-origin: top center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); display: flex; flex-direction: column;
        }

        /* CABE√áALHO DA ESCOLA */
        .doc-header { border-bottom: 2px solid #000; margin-bottom: 15px; padding-bottom: 10px; }
        .doc-header [contenteditable] { padding: 2px 5px; outline: none; border-bottom: 1px dashed #ccc; }

        /* AMBIENTE DA SALA */
        .sala-area { 
            flex-grow: 1; border: 10px solid var(--parede); border-radius: 8px;
            display: flex; flex-direction: column; position: relative; background: #fff;
        }

        .element-topo { height: 40px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; border-bottom: 2px solid var(--parede); }
        .element-base { height: 70px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; border-top: 2px solid var(--parede); position: relative; }
        
        .quadro-v2 { width: 60%; height: 35px; background: #065f46; border: 3px solid #451a03; border-radius: 4px; color: white; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }

        .grid-layout { display: grid; gap: 10px; padding: 15px; flex-grow: 1; align-content: center; }

        /* CARTEIRA DETALHADA */
        .desk-unit { 
            background: var(--carteira) !important; border-radius: 8px; padding: 6px;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.1);
        }
        .student-photo { 
            width: 45px; height: 45px; background: #fff; border-radius: 50%; 
            overflow: hidden; border: 2px solid white; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .student-photo img { width: 100%; height: 100%; object-fit: cover; }
        .student-name { 
            width: 100%; border: none; background: rgba(255,255,255,0.9); 
            text-align: center; font-size: 9px; font-weight: 800; border-radius: 4px; padding: 2px 0;
        }

        /* BARRA INFERIOR DE CONTROLE */
        footer { background: #1e293b; padding: 15px; border-top: 2px solid #3b82f6; }
        .nav-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 500px; margin: 0 auto; }
        
        .btn-ctrl { 
            background: #334155; border: none; color: white; padding: 10px; 
            border-radius: 12px; display: flex; flex-direction: column; align-items: center;
            font-size: 10px; font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .btn-ctrl:active { background: #3b82f6; transform: scale(0.95); }
        .btn-ctrl span { font-size: 20px; margin-bottom: 5px; }
        .btn-save { background: #2563eb; }

        /* MODAL DE AJUSTES */
        .modal-full { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 100; padding: 20px; flex-direction: column; justify-content: center;
        }
        .modal-card { background: #fff; color: #000; border-radius: 20px; padding: 25px; width: 100%; max-width: 400px; margin: 0 auto; }
        .field { margin-bottom: 15px; }
        .field label { display: block; font-size: 11px; font-weight: 800; color: #64748b; margin-bottom: 5px; }
        .field input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; }

        @media print {
            body { background: white; }
            header, footer, .modal-full { display: none !important; }
            .viewport { padding: 0; background: white; overflow: visible; }
            .a4-page { transform: scale(1) !important; margin: 0 !important; box-shadow: none; border: none; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

<header>
    <h1>PLANO DE SALA PRO V30</h1>
    <div style="font-size: 10px; color: #94a3b8;" id="statusMsg">Autosalvamento Ativo</div>
</header>

<main class="viewport" id="vPort">
    <div class="a4-page" id="folha">
        <div class="doc-header">
            <h2 contenteditable="true" style="text-align: center; font-size: 20px; margin-bottom: 10px;">MAPA DE ASSENTAMENTO ESCOLAR</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                <div><b>ESCOLA:</b> <span contenteditable="true" id="save-escola">Nome da Institui√ß√£o</span></div>
                <div><b>TURMA:</b> <span contenteditable="true" id="save-turma">___ Ano ___</span></div>
                <div><b>PROFESSOR(A):</b> <span contenteditable="true" id="save-prof">M√°rcio</span></div>
                <div><b>DATA:</b> <span contenteditable="true" id="save-data">__/__/2026</span></div>
            </div>
        </div>

        <div class="sala-area">
            <div class="element-topo" contenteditable="true">SMART TV / PAREDE FUNDO</div>
            
            <div id="mainGrid" class="grid-layout"></div>

            <div class="element-base">
                <div style="position: absolute; left: 15px; font-size: 10px; font-weight: 800; color: #64748b;">ENTRADA</div>
                <div class="quadro-v2" contenteditable="true">QUADRO NEGRO</div>
                <div style="position: absolute; right: 15px; font-size: 10px; font-weight: 800; color: #64748b;">BIR√î</div>
            </div>
        </div>
    </div>
</main>

<div id="modalConfig" class="modal-full">
    <div class="modal-card">
        <h2 style="margin-bottom: 20px;">Configurar Layout</h2>
        <div class="field">
            <label>COLUNAS (Lado a Lado)</label>
            <input type="number" id="inpCols" value="5">
        </div>
        <div class="field">
            <label>FILEIRAS (Frente ao Fundo)</label>
            <input type="number" id="inpRows" value="6">
        </div>
        <div class="field">
            <label>COR DAS CARTEIRAS</label>
            <input type="color" id="inpColor" value="#f59e0b" style="height: 50px;">
        </div>
        <button onclick="salvarConfig()" style="width:100%; background: #2563eb; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 800;">APLICAR E SALVAR</button>
    </div>
</div>

<footer>
    <div class="nav-grid">
        <button class="btn-ctrl" onclick="ajustarZoom(0.1)"><span>‚ûï</span>ZOOM</button>
        <button class="btn-ctrl" onclick="ajustarZoom(-0.1)"><span>‚ûñ</span>ZOOM</button>
        <button class="btn-ctrl" onclick="abrirConfig()"><span>‚öôÔ∏è</span>AJUSTES</button>
        <button class="btn-ctrl btn-save" onclick="window.print()"><span>üíæ</span>PDF</button>
    </div>
</footer>

<script>
    let zoomLevel = 0.45;

    function ajustarZoom(val) {
        zoomLevel += val;
        document.documentElement.style.setProperty('--zoom', zoomLevel);
    }

    function abrirConfig() {
        document.getElementById('modalConfig').style.display = 'flex';
    }

    function renderizarSala() {
        const grid = document.getElementById('mainGrid');
        const c = document.getElementById('inpCols').value;
        const r = document.getElementById('inpRows').value;
        const cor = document.getElementById('inpColor').value;

        document.documentElement.style.setProperty('--carteira', cor);
        grid.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
        grid.innerHTML = '';

        for (let i = 0; i < (c * r); i++) {
            const id = `aluno-${i}`;
            const savedName = localStorage.getItem(id) || "";
            const savedFoto = localStorage.getItem(id+'-foto') || `https://api.dicebear.com/7.x/initials/svg?seed=${i}`;

            const div = document.createElement('div');
            div.className = 'desk-unit';
            div.innerHTML = `
                <div class="student-photo" onclick="triggerFile(${i})">
                    <img src="${savedFoto}" id="img-${i}">
                </div>
                <input type="file" id="file-${i}" style="display:none" accept="image/*" onchange="subirFoto(this, ${i})">
                <input type="text" class="student-name" placeholder="Aluno ${i+1}" value="${savedName}" oninput="salvarNome(${i}, this.value)">
            `;
            grid.appendChild(div);
        }
    }

    function triggerFile(i) { document.getElementById(`file-${i}`).click(); }

    function subirFoto(input, i) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById(`img-${i}`).src = e.target.result;
                localStorage.setItem(`aluno-${i}-foto`, e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function salvarNome(i, valor) {
        localStorage.setItem(`aluno-${i}`, valor);
    }

    function salvarConfig() {
        document.getElementById('modalConfig').style.display = 'none';
        renderizarSala();
        // Salva as configs gerais
        localStorage.setItem('config-cols', document.getElementById('inpCols').value);
        localStorage.setItem('config-rows', document.getElementById('inpRows').value);
        localStorage.setItem('config-color', document.getElementById('inpColor').value);
    }

    // Carregar dados salvos ao abrir
    window.onload = () => {
        if(localStorage.getItem('config-cols')) {
            document.getElementById('inpCols').value = localStorage.getItem('config-cols');
            document.getElementById('inpRows').value = localStorage.getItem('config-rows');
            document.getElementById('inpColor').value = localStorage.getItem('config-color');
        }
        
        // Carrega textos do cabe√ßalho
        ['escola', 'turma', 'prof', 'data'].forEach(item => {
            const el = document.getElementById('save-'+item);
            if(localStorage.getItem('text-'+item)) el.innerText = localStorage.getItem('text-'+item);
            el.onblur = () => localStorage.setItem('text-'+item, el.innerText);
        });

        renderizarSala();
        if(window.innerWidth < 768) zoomLevel = 0.35;
        ajustarZoom(0);
    };
</script>

</body>
</html>