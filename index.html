<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SALA M√ÅRCIO V31 - EDI√á√ÉO TOTAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root {
            --primary: #2563eb;
            --carteira: #f59e0b;
            --zoom: 0.45;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { 
            background: #0f172a; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* BARRA SUPERIOR */
        header { 
            background: #1e293b; padding: 12px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 2px solid var(--primary); z-index: 100;
        }
        header h1 { font-size: 14px; color: #fff; font-weight: 900; }

        /* √ÅREA DE EDI√á√ÉO */
        .viewport { 
            flex-grow: 1; overflow: auto; display: flex; justify-content: center; 
            align-items: flex-start; padding: 60px 20px; background: #334155; 
        }

        /* FOLHA A4 - ESTRUTURA R√çGIDA PARA N√ÉO DESCONFIGURAR */
        .a4-page {
            width: 210mm; height: 297mm; background: #fff; color: #000;
            padding: 10mm; position: relative; flex-shrink: 0;
            transform: scale(var(--zoom)); transform-origin: top center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
        }

        /* CABE√áALHO EDIT√ÅVEL */
        .doc-header { border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 10px; }
        .edit-field { outline: none; border-bottom: 1px dashed #ddd; padding: 2px 4px; display: inline-block; min-width: 50px; }
        .edit-field:focus { background: #fff9c4; border-bottom: 1px solid var(--primary); }

        /* SALA */
        .sala-box { 
            flex-grow: 1; border: 12px solid #1e293b; border-radius: 4px;
            display: flex; flex-direction: column; background: #fff;
        }

        .item-editavel { cursor: text; text-transform: uppercase; font-weight: 800; font-size: 10px; text-align: center; outline: none; }
        
        .topo-sala { height: 40px; display: flex; align-items: center; justify-content: center; border-bottom: 2px solid #eee; }
        .tv-label { background: #000; color: #fff; padding: 2px 20px; border-radius: 0 0 10px 10px; }

        .base-sala { height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-top: 2px solid #eee; }
        .quadro { width: 50%; height: 40px; background: #065f46; border: 3px solid #451a03; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 14px; }

        /* GRID */
        .grid-layout { 
            display: grid; gap: 10px; padding: 15px; flex-grow: 1; 
            align-content: center; justify-items: center;
        }

        /* CARTEIRA */
        .carteira { 
            background: var(--carteira) !important; width: 100%; aspect-ratio: 1/1; 
            border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 4px;
        }
        .foto-placeholder { 
            width: 50%; aspect-ratio: 1/1; background: #fff; border-radius: 50%; 
            overflow: hidden; border: 2px solid white; cursor: pointer;
        }
        .foto-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .nome-aluno { 
            width: 95%; border: none; background: #fff; text-align: center; 
            font-size: 8px; font-weight: 900; border-radius: 2px; padding: 2px 0;
        }

        /* RODAP√â MOBILE */
        footer { background: #1e293b; padding: 10px; border-top: 2px solid var(--primary); }
        .menu-btns { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; max-width: 500px; margin: 0 auto; }
        .btn { 
            background: #334155; border: none; color: white; padding: 12px 5px; 
            border-radius: 10px; font-size: 9px; font-weight: 700; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .btn-print { background: var(--primary); }
        .btn span { font-size: 18px; }

        /* MODAL */
        .modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            z-index: 500; align-items: center; justify-content: center; padding: 20px; 
        }
        .modal-box { background: white; width: 100%; max-width: 400px; padding: 20px; border-radius: 15px; }
        .modal-box label { display: block; font-size: 11px; font-weight: 800; margin: 10px 0 5px; color: #444; }
        .modal-box input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }

        @media print {
            header, footer, .modal { display: none !important; }
            body { background: white; overflow: visible; }
            .viewport { padding: 0; background: white; display: block; }
            .a4-page { transform: scale(1) !important; margin: 0 !important; box-shadow: none; border: none; }
            .edit-field { border: none; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

<header>
    <h1>MAPA DE SALA PRO V31</h1>
    <div style="background: #065f46; font-size: 9px; padding: 3px 8px; border-radius: 4px;">MODO EDI√á√ÉO ATIVO</div>
</header>

<main class="viewport">
    <div class="a4-page" id="folha">
        <div class="doc-header">
            <div contenteditable="true" class="item-editavel" style="font-size: 22px; margin-bottom: 10px;" id="txt-titulo">MAPA DE ASSENTAMENTO</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                <div><b>ESCOLA:</b> <span contenteditable="true" class="edit-field" id="txt-escola">Clique para digitar</span></div>
                <div><b>TURMA:</b> <span contenteditable="true" class="edit-field" id="txt-turma">___</span></div>
                <div><b>PROFESSOR:</b> <span contenteditable="true" class="edit-field" id="txt-prof">M√°rcio</span></div>
                <div><b>DATA:</b> <span contenteditable="true" class="edit-field" id="txt-data">__/__/__</span></div>
            </div>
        </div>

        <div class="sala-box">
            <div class="topo-sala">
                <div contenteditable="true" class="item-editavel tv-label" id="txt-tv">SMART TV / PAREDE FUNDO</div>
            </div>
            
            <div id="gridSala" class="grid-layout"></div>

            <div class="base-sala">
                <div contenteditable="true" class="item-editavel" id="txt-entrada">ENTRADA</div>
                <div contenteditable="true" class="item-editavel quadro" id="txt-quadro">QUADRO</div>
                <div contenteditable="true" class="item-editavel" id="txt-biro">BIR√î</div>
            </div>
        </div>
    </div>
</main>

<div id="modalAjustes" class="modal">
    <div class="modal-box">
        <h2 style="margin-bottom:15px;">Ajustar Grade</h2>
        <label>COLUNAS (Lado a Lado)</label>
        <input type="number" id="qCols" value="5">
        <label>FILEIRAS (Frente ao Fundo)</label>
        <input type="number" id="qRows" value="6">
        <label>COR DAS CARTEIRAS</label>
        <input type="color" id="qCor" value="#f59e0b">
        <button onclick="salvarAjustes()" style="width:100%; background:var(--primary); color:white; border:none; padding:12px; margin-top:20px; border-radius:8px; font-weight:800;">APLICAR</button>
    </div>
</div>

<footer>
    <div class="menu-btns">
        <button class="btn" onclick="mudarZoom(0.05)"><span>‚ûï</span>ZOOM</button>
        <button class="btn" onclick="mudarZoom(-0.05)"><span>‚ûñ</span>ZOOM</button>
        <button class="btn" onclick="document.getElementById('modalAjustes').style.display='flex'"><span>‚öôÔ∏è</span>GRADES</button>
        <button class="btn btn-print" onclick="window.print()"><span>üíæ</span>PDF</button>
    </div>
</footer>

<script>
    let zoom = 0.42;

    function mudarZoom(v) {
        zoom += v;
        document.documentElement.style.setProperty('--zoom', zoom);
    }

    function render() {
        const grid = document.getElementById('gridSala');
        const c = localStorage.getItem('cols') || 5;
        const r = localStorage.getItem('rows') || 6;
        const cor = localStorage.getItem('cor') || '#f59e0b';
        
        document.getElementById('qCols').value = c;
        document.getElementById('qRows').value = r;
        document.getElementById('qCor').value = cor;
        document.documentElement.style.setProperty('--carteira', cor);

        grid.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
        grid.innerHTML = '';

        for (let i = 0; i < (c * r); i++) {
            const div = document.createElement('div');
            div.className = 'carteira';
            const sNome = localStorage.getItem(`n-${i}`) || "";
            const sFoto = localStorage.getItem(`f-${i}`) || `https://api.dicebear.com/7.x/initials/svg?seed=${i}`;
            
            div.innerHTML = `
                <div class="foto-placeholder" onclick="document.getElementById('file-${i}').click()">
                    <img src="${sFoto}" id="img-${i}">
                </div>
                <input type="file" id="file-${i}" style="display:none" onchange="upload(${i}, this)">
                <input type="text" class="nome-aluno" value="${sNome}" placeholder="NOME" oninput="localStorage.setItem('n-${i}', this.value)">
            `;
            grid.appendChild(div);
        }
    }

    function upload(i, input) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                document.getElementById(`img-${i}`).src = e.target.result;
                localStorage.setItem(`f-${i}`, e.target.result);
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function salvarAjustes() {
        localStorage.setItem('cols', document.getElementById('qCols').value);
        localStorage.setItem('rows', document.getElementById('qRows').value);
        localStorage.setItem('cor', document.getElementById('qCor').value);
        document.getElementById('modalAjustes').style.display = 'none';
        render();
    }

    // Salva textos edit√°veis automaticamente
    const idsTextos = ['txt-titulo', 'txt-escola', 'txt-turma', 'txt-prof', 'txt-data', 'txt-tv', 'txt-entrada', 'txt-quadro', 'txt-biro'];
    
    idsTextos.forEach(id => {
        const el = document.getElementById(id);
        if(localStorage.getItem(id)) el.innerText = localStorage.getItem(id);
        el.oninput = () => localStorage.setItem(id, el.innerText);
    });

    window.onload = () => {
        render();
        if(window.innerWidth < 600) zoom = 0.35;
        mudarZoom(0);
    };
</script>
</body>
</html>