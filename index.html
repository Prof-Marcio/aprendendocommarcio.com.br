<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SALA M√ÅRCIO V25 - MOBILE FIX</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        :root {
            --primary: #3b82f6;
            --parede: #1e293b;
            --fundo-sala: #ffffff;
            --cor-carteira: #f59e0b;
            --cor-texto-aluno: #000000;
            --cor-quadro: #065f46;
            --cor-tv: #000000;
            --zoom: 0.75;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { 
            background: #cbd5e1; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
            touch-action: pan-x pan-y; /* Melhora o scroll no mobile */
        }

        /* --- BOT√ÉO AJUDA MOBILE --- */
        .btn-help {
            position: fixed; top: 10px; right: 10px; width: 40px; height: 40px;
            background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 18px; cursor: pointer; z-index: 2000;
            border: 2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        #modalHelp {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000; justify-content: center; align-items: center; padding: 15px;
        }

        .help-content {
            background: white; width: 95%; max-width: 450px; padding: 20px; border-radius: 15px;
            max-height: 85vh; overflow-y: auto;
        }

        .btn-close-help { background: #ef4444; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: 800; margin-top: 15px; }

        /* --- CONTAINER E P√ÅGINA --- */
        .main-container { 
            flex-grow: 1; overflow: auto; display: flex; justify-content: center; 
            align-items: flex-start; padding: 10px; background: #cbd5e1;
        }

        .a4-page {
            width: 210mm; height: 297mm; background: #fff; padding: 10mm; position: relative; flex-shrink: 0;
            transform: scale(var(--zoom)); transform-origin: top center; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; border-radius: 4px;
        }

        .sala-box {
            width: 100%; flex: 1; border: 12px solid var(--parede); position: relative; 
            display: flex; flex-direction: column; border-radius: 8px; background: var(--fundo-sala);
            overflow: hidden;
        }

        /* --- ELEMENTOS DA SALA --- */
        .area-fundo { height: 40px; display: flex; justify-content: center; width: 100%; }
        .tv-topo { width: 180px; height: 12px; background: var(--cor-tv); border-radius: 0 0 8px 8px; color: #fff; font-size: 7px; font-weight: 800; display: flex; align-items: center; justify-content: center; }

        .grid-alunos { flex: 1; display: grid; gap: 8px; padding: 10px; align-content: center; justify-items: center; }

        .desk { 
            background: var(--cor-carteira) !important; width: 100%; max-width: 90px; aspect-ratio: 1/1;
            border-radius: 8px; padding: 4px; display: flex; flex-direction: column; 
            align-items: center; justify-content: space-between; border: 1px solid rgba(0,0,0,0.1);
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }

        .foto-aluno { width: 42%; aspect-ratio: 1/1; background: #eee; border-radius: 50%; border: 1.5px solid #fff; overflow: hidden; }
        .foto-aluno img { width: 100%; height: 100%; object-fit: cover; }
        
        .nome-aluno { 
            width: 100%; background: rgba(255,255,255,0.9); border: none; border-radius: 3px; 
            text-align: center; font-weight: 800; font-size: 8px; color: var(--cor-texto-aluno);
            -webkit-appearance: none; /* Remove sombras no iOS */
        }

        .area-frente { height: 80px; display: flex; justify-content: center; align-items: center; width: 100%; position: relative; }
        .quadro { 
            width: 55%; height: 40px; background: var(--cor-quadro) !important; border: 3px solid #451a03; 
            border-radius: 4px; color: #fff; display: flex; align-items: center; justify-content: center; 
            font-weight: 700; font-size: 14px; -webkit-print-color-adjust: exact;
        }

        .label-parede { position: absolute; background: #fff !important; padding: 3px 8px; font-weight: 800; font-size: 10px; color: var(--parede); border: 2px solid var(--parede); border-radius: 4px; }
        .entrada-pos { left: -10px; bottom: 20px; transform: rotate(-90deg); }
        .biro-pos { right: -10px; bottom: 20px; transform: rotate(90deg); }

        /* --- FOOTER RESPONSIVO --- */
        footer { background: #fff; border-top: 1px solid #cbd5e1; padding: 10px; z-index: 1000; }
        .toolbar { display: flex; gap: 10px; overflow-x: auto; align-items: flex-end; padding-bottom: 5px; }
        .tool-group { display: flex; flex-direction: column; gap: 3px; min-width: 80px; flex-shrink: 0; }
        .tool-group label { font-size: 8px; font-weight: 800; color: #64748b; text-transform: uppercase; text-align: center; }
        
        input[type="number"], input[type="range"] { padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; width: 100%; }
        input[type="color"] { width: 100%; height: 30px; border: none; cursor: pointer; background: none; }
        .btn-print { background: var(--primary); color: white; border: none; padding: 0 15px; border-radius: 8px; font-weight: 800; cursor: pointer; height: 40px; flex-shrink: 0; font-size: 12px; }

        /* --- AJUSTES MOBILE ESPEC√çFICOS --- */
        @media (max-width: 768px) {
            .main-container { align-items: center; }
            .a4-page { 
                margin-top: 0;
                /* O segredo est√° aqui: calculamos o zoom baseado na largura da tela do celular */
                transform: scale(calc(window.innerWidth / 850)); 
            }
        }

        /* --- IMPRESS√ÉO --- */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: white !important; overflow: visible; }
            footer, .btn-help { display: none !important; }
            .main-container { padding: 0; margin: 0; overflow: visible; display: block; }
            .a4-page { transform: scale(1) !important; margin: 0 !important; width: 210mm; height: 297mm; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

<div class="btn-help" onclick="toggleHelp(true)">?</div>

<div id="modalHelp">
    <div class="help-content">
        <h2 style="color:var(--primary); margin-bottom:10px;">üìñ Dicas Celular</h2>
        <p style="font-size: 14px; line-height: 1.5; color:#333;">
            1. <b>Zoom:</b> Use a barra no rodap√© para ajustar o tamanho da folha na sua tela.<br><br>
            2. <b>Fotos:</b> Toque no c√≠rculo branco para abrir a galeria do celular.<br><br>
            3. <b>Teclado:</b> Se o teclado cobrir a tela, use o scroll para subir a folha.<br><br>
            4. <b>PDF:</b> No celular, ao clicar em imprimir, escolha "Salvar como PDF" nas op√ß√µes da impressora.
        </p>
        <button class="btn-close-help" onclick="toggleHelp(false)">VOLTAR</button>
    </div>
</div>

<main class="main-container" id="container">
    <div class="a4-page" id="folha">
        <h2 contenteditable="true" style="text-align:center; margin-bottom:12px; font-weight:800; font-size: 20px; color: #1e293b;">PLANO DE SALA: _________</h2>
        <div class="sala-box">
            <div class="area-fundo"><div class="tv-topo" contenteditable="true">SMART TV</div></div>
            <div id="grid" class="grid-alunos"></div>
            <div class="area-frente">
                <div class="label-parede entrada-pos">ENTRADA</div>
                <div class="quadro" contenteditable="true">QUADRO</div>
                <div class="label-parede biro-pos">BIR√î</div>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="toolbar">
        <div class="tool-group"><label>üîç Zoom</label><input type="range" id="zoom" min="0.2" max="1.2" step="0.05" value="0.4" oninput="update()"></div>
        <div class="tool-group"><label>‚ÜîÔ∏è Colunas</label><input type="number" id="cols" value="5" min="1" onchange="render()"></div>
        <div class="tool-group"><label>‚ÜïÔ∏è Fileiras</label><input type="number" id="rows" value="6" min="1" onchange="render()"></div>
        <div class="tool-group"><label>üß± Parede</label><input type="color" id="cParede" value="#1e293b" oninput="update()"></div>
        <div class="tool-group"><label>ü™ë Carteira</label><input type="color" id="cDesk" value="#f59e0b" oninput="update()"></div>
        <div class="tool-group"><label>‚úçÔ∏è Nomes</label><input type="color" id="cText" value="#000000" oninput="update()"></div>
        <button class="btn-print" onclick="window.print()">IMPRIMIR PDF</button>
    </div>
</footer>

<script>
    function toggleHelp(show) { document.getElementById('modalHelp').style.display = show ? 'flex' : 'none'; }

    function update() {
        const val = document.getElementById('zoom').value;
        document.documentElement.style.setProperty('--zoom', val);
        document.getElementById('folha').style.transform = `scale(${val})`;
    }

    function render() {
        const grid = document.getElementById('grid');
        const c = parseInt(document.getElementById('cols').value) || 1;
        const r = parseInt(document.getElementById('rows').value) || 1;
        grid.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
        grid.innerHTML = '';
        for (let i = 0; i < (r * c); i++) {
            const cell = document.createElement('div');
            cell.className = 'desk';
            cell.innerHTML = `
                <div class="foto-aluno" onclick="this.nextElementSibling.click()"><img src="https://api.dicebear.com/7.x/initials/svg?seed=A${i}"></div>
                <input type="file" style="display:none" accept="image/*" onchange="subirFoto(this)">
                <input type="text" class="nome-aluno" placeholder="Aluno">
            `;
            grid.appendChild(cell);
        }
    }

    function subirFoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => { input.previousElementSibling.querySelector('img').src = e.target.result; };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Ajuste inicial para mobile
    window.onload = () => {
        if(window.innerWidth < 768) {
            document.getElementById('zoom').value = 0.35;
        }
        render(); 
        update(); 
    }
</script>
</body>
</html>