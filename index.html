<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SALA M√ÅRCIO V32 - DIN√ÇMICA TOTAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root {
            --primary: #3b82f6;
            --carteira: #f59e0b;
            --parede: #1e293b;
            --zoom: 0.45;
            --fonte-size: 10px;
            --desk-size: 100%;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { background: #0f172a; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        header { background: #1e293b; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); color: white; }
        header h1 { font-size: 12px; font-weight: 900; }

        /* VIEWPORT */
        .viewport { flex-grow: 1; overflow: auto; display: flex; justify-content: center; align-items: flex-start; padding: 50px 20px; background: #334155; }

        /* A4 DIN√ÇMICO */
        .a4-page {
            width: 210mm; height: 297mm; background: #fff; padding: 10mm; position: relative; flex-shrink: 0;
            transform: scale(var(--zoom)); transform-origin: top center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6); display: flex; flex-direction: column;
        }

        /* CABE√áALHO */
        .doc-header { border: 2px solid #000; padding: 10px; margin-bottom: 10px; }
        [contenteditable] { outline: none; transition: 0.2s; }
        [contenteditable]:focus { background: #ffffd0; padding: 2px; }

        /* SALA BOX */
        .sala-box { 
            flex-grow: 1; border: 15px solid var(--parede); position: relative;
            display: flex; flex-direction: column; background: #fff; transition: 0.3s;
        }

        .area-interativa { display: flex; align-items: center; justify-content: center; min-height: 40px; padding: 5px; }
        .label-movel { font-weight: 900; font-size: 12px; cursor: pointer; text-transform: uppercase; }

        /* GRID */
        #gridSala { 
            display: grid; gap: 10px; padding: 15px; flex-grow: 1; 
            align-content: center; justify-items: center;
        }

        /* CARTEIRA DIN√ÇMICA */
        .carteira { 
            background: var(--carteira) !important; width: var(--desk-size); aspect-ratio: 1/1; 
            border-radius: 8px; border: 2px solid rgba(0,0,0,0.1);
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .foto-aluno { width: 50%; aspect-ratio: 1/1; background: #fff; border-radius: 50%; border: 2px solid white; overflow: hidden; margin-bottom: 4px; }
        .foto-aluno img { width: 100%; height: 100%; object-fit: cover; }
        .nome-aluno { width: 100%; border: none; background: #fff; text-align: center; font-size: var(--fonte-size); font-weight: 800; border-radius: 4px; }

        /* MENU INFERIOR */
        footer { background: #1e293b; padding: 10px; border-top: 2px solid var(--primary); }
        .toolbar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 600px; margin: 0 auto; }
        .btn { background: #334155; border: none; color: white; border-radius: 12px; padding: 10px 5px; font-size: 9px; font-weight: 700; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .btn-ok { background: var(--primary); }
        .btn span { font-size: 18px; }

        /* PAINEL DE CONTROLE LATERAL (GAVETA) */
        .drawer { 
            position: fixed; bottom: 0; left: 0; width: 100%; background: white; 
            border-radius: 25px 25px 0 0; padding: 25px; z-index: 1000;
            display: none; flex-direction: column; box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
            max-height: 80vh; overflow-y: auto;
        }
        .drawer-row { margin-bottom: 20px; }
        .drawer-row label { display: block; font-size: 11px; font-weight: 900; color: #444; margin-bottom: 8px; }
        .drawer-row input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; }

        @media print {
            header, footer, .drawer { display: none !important; }
            body { background: white; }
            .viewport { padding: 0; display: block; }
            .a4-page { transform: scale(1) !important; margin: 0 !important; box-shadow: none; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

<header>
    <h1>CONFIGURA√á√ÉO DIN√ÇMICA</h1>
    <div id="status">Sincronizado</div>
</header>

<main class="viewport">
    <div class="a4-page" id="folha">
        <div class="doc-header">
            <h2 contenteditable="true" id="txt-h1" style="text-align: center; font-size: 20px; margin-bottom: 10px;">PLANO DE SALA DIN√ÇMICO</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; font-size: 12px; gap: 5px;">
                <div contenteditable="true" id="txt-info1">ESCOLA: Unidade Escolar...</div>
                <div contenteditable="true" id="txt-info2">TURMA: 1¬∫ Ano A</div>
                <div contenteditable="true" id="txt-info3">PROFESSOR: M√°rcio</div>
                <div contenteditable="true" id="txt-info4">DATA: __/__/__</div>
            </div>
        </div>

        <div class="sala-box" id="boxSala">
            <div class="area-interativa" style="border-bottom: 2px dashed #eee;">
                <div contenteditable="true" class="label-movel" id="txt-topo" style="background: #000; color: #fff; padding: 2px 15px; border-radius: 5px;">SMART TV / FUNDO</div>
            </div>
            
            <div id="gridSala"></div>

            <div class="area-interativa" style="border-top: 2px dashed #eee; justify-content: space-around;">
                <div contenteditable="true" class="label-movel" id="txt-item1">ENTRADA</div>
                <div contenteditable="true" class="label-movel" id="txt-item2" style="background:#065f46; color:white; padding:5px 30px; border:2px solid #451a03;">QUADRO</div>
                <div contenteditable="true" class="label-movel" id="txt-item3">BIR√î</div>
            </div>
        </div>
    </div>
</main>

<div id="drawer" class="drawer">
    <h2 style="margin-bottom: 20px; text-align: center;">Personalizar Sala</h2>
    <div class="drawer-row">
        <label>QUANTIDADE DE ALUNOS (COLUNAS x FILEIRAS)</label>
        <div style="display: flex; gap: 10px;">
            <input type="number" id="vCols" value="5" placeholder="Cols">
            <input type="number" id="vRows" value="6" placeholder="Rows">
        </div>
    </div>
    <div class="drawer-row">
        <label>TAMANHO DAS CARTEIRAS (%)</label>
        <input type="range" id="vDeskSize" min="50" max="100" value="100" oninput="ajustarEstilo()">
    </div>
    <div class="drawer-row">
        <label>TAMANHO DA FONTE DOS NOMES</label>
        <input type="range" id="vFontSize" min="6" max="16" value="10" oninput="ajustarEstilo()">
    </div>
    <div class="drawer-row">
        <label>CORES (CARTEIRA E PAREDE)</label>
        <div style="display: flex; gap: 10px;">
            <input type="color" id="vColorDesk" value="#f59e0b" oninput="ajustarEstilo()">
            <input type="color" id="vColorWall" value="#1e293b" oninput="ajustarEstilo()">
        </div>
    </div>
    <button class="btn-ok" style="width: 100%; border: none; padding: 15px; color: white; border-radius: 12px; font-weight: 900;" onclick="toggleDrawer()">SALVAR E FECHAR</button>
</div>

<footer>
    <div class="toolbar">
        <button class="btn" onclick="mudarZoom(0.05)"><span>‚ûï</span>ZOOM</button>
        <button class="btn" onclick="mudarZoom(-0.05)"><span>‚ûñ</span>ZOOM</button>
        <button class="btn" onclick="toggleDrawer()"><span>üé®</span>ESTILO</button>
        <button class="btn btn-ok" onclick="window.print()"><span>üíæ</span>PDF</button>
    </div>
</footer>

<script>
    let zoom = 0.42;

    function mudarZoom(v) {
        zoom += v;
        document.documentElement.style.setProperty('--zoom', zoom);
    }

    function toggleDrawer() {
        const d = document.getElementById('drawer');
        d.style.display = (d.style.display === 'flex') ? 'none' : 'flex';
        renderGrid();
    }

    function ajustarEstilo() {
        const desk = document.getElementById('vDeskSize').value + '%';
        const font = document.getElementById('vFontSize').value + 'px';
        const cDesk = document.getElementById('vColorDesk').value;
        const cWall = document.getElementById('vColorWall').value;

        document.documentElement.style.setProperty('--desk-size', desk);
        document.documentElement.style.setProperty('--fonte-size', font);
        document.documentElement.style.setProperty('--carteira', cDesk);
        document.documentElement.style.setProperty('--parede', cWall);
        
        localStorage.setItem('config-v32', JSON.stringify({
            cols: document.getElementById('vCols').value,
            rows: document.getElementById('vRows').value,
            desk, font, cDesk, cWall
        }));
    }

    function renderGrid() {
        const grid = document.getElementById('gridSala');
        const c = document.getElementById('vCols').value;
        const r = document.getElementById('vRows').value;
        
        grid.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
        grid.innerHTML = '';

        for (let i = 0; i < (c * r); i++) {
            const div = document.createElement('div');
            div.className = 'carteira';
            const sNome = localStorage.getItem(`v32-n-${i}`) || "";
            const sFoto = localStorage.getItem(`v32-f-${i}`) || `https://api.dicebear.com/7.x/initials/svg?seed=${i}`;
            
            div.innerHTML = `
                <div class="foto-aluno" onclick="document.getElementById('file-${i}').click()">
                    <img src="${sFoto}" id="img-${i}">
                </div>
                <input type="file" id="file-${i}" style="display:none" onchange="upload(${i}, this)">
                <input type="text" class="nome-aluno" value="${sNome}" placeholder="Aluno" oninput="localStorage.setItem('v32-n-${i}', this.value)">
            `;
            grid.appendChild(div);
        }
    }

    function upload(i, input) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                document.getElementById(`img-${i}`).src = e.target.result;
                localStorage.setItem(`v32-f-${i}`, e.target.result);
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    // Salva automaticamente todos os textos clic√°veis
    document.querySelectorAll('[contenteditable]').forEach(el => {
        const id = el.id;
        if(localStorage.getItem('v32-'+id)) el.innerHTML = localStorage.getItem('v32-'+id);
        el.oninput = () => localStorage.setItem('v32-'+id, el.innerHTML);
    });

    window.onload = () => {
        const config = JSON.parse(localStorage.getItem('config-v32'));
        if(config) {
            document.getElementById('vCols').value = config.cols;
            document.getElementById('vRows').value = config.rows;
            document.getElementById('vColorDesk').value = config.cDesk;
            document.getElementById('vColorWall').value = config.cWall;
            document.getElementById('vDeskSize').value = parseInt(config.desk);
            document.getElementById('vFontSize').value = parseInt(config.font);
            ajustarEstilo();
        }
        renderGrid();
        if(window.innerWidth < 600) zoom = 0.35;
        mudarZoom(0);
    };
</script>

</body>
</html>